---
title: "Paper Visualizations"
author: "Amanda Konet"
date: "`r date()`"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F, error = F)
library(tidyverse)
library(ggplot2)
library(boxr)
library(stargazer)
box_auth()

df <- box_read("949901868853", read_fun = readr::read_csv)
amicus <- box_read("947307207905", read_fun = readr::read_csv)
```


# Cases per Year


```{r}
num_cases <- df %>%  distinct(case, decision_date=ddate2) %>% 
  group_by(decision_date) %>% 
  summarize(n = n())

num_cases %>% 
  ggplot(., aes(x = decision_date, y = n)) +
  geom_line() + 
  labs(
    x = "Decision Year",
    y = "Count of Amici",
    title = "Number of Amici per Case"
  ) +
  theme_minimal()
```


# Number of Amici by Case

Data

```{r}
num_amici <- df %>% 
  distinct(year = lubridate::year(ddate2), cfemam, coppam) %>% 
  group_by(year) %>% 
  summarize(cfemam = mean(cfemam), coppam = mean(coppam))
```

Plot

```{r}
amici_ct_plt <- num_amici %>% 
  ggplot(., aes(x = year)) +
  geom_line(aes(y = cfemam, linetype = "Feminist")) + 
  geom_line(aes(y = coppam, linetype = "Opponent")) + 
  scale_linetype_manual("Party", values=c("Feminist" = 1,"Opponent" = 2)) + 
  coord_cartesian(ylim = c(0, 50)) +
  labs(
    x = "Decision Year",
    y = "Average Number of Amici",
    title = "Annual Average Number of Amici for Abortion Cases"
  ) + 
  theme_minimal() +
  theme(
    title = element_text(size = 10)
  )

ggsave("graphics/avg_amici_time.png",amici_ct_plt, height = 5, width = 8)
amici_ct_plt
```
Check spike
```{r}
df %>% filter(lubridate::year(ddate2) == 1989) %>% distinct(case, ddate2, cfemam, coppam)
```

# Table 1

```{r, results='asis'}
author_types <- amicus %>% select(chcauf, lifauo, medauf, medauo, legauf, legauo, relauf, relauo) %>%
  mutate(across(where(is.character), as.numeric)) %>%
  summarise(across(where(is.numeric), ~ sum(.x, na.rm = TRUE))) %>%
  pivot_longer(.,cols = c(chcauf, lifauo, medauf, medauo, legauf, legauo, relauf, relauo), names_to = "var", values_to = "ct") %>%
  arrange(var)

author_types <- author_types %>% mutate(author_type = substr(var, 1, 3), position = substr(var, 4, 6)) %>% select(-var)

author_types$position <- ifelse(author_types$position == "auf", 'Reproductive Rights', 'Antiabortion')
author_types <- author_types %>% mutate(`Amicus Author Type` = case_when(
  author_type == 'chc' ~ 'Feminist Organizations',
  author_type == 'lif' ~ 'Anti-Feminist Organizations',
  author_type == 'med' ~ 'Medical Practioners/Orgs/Researchers/Educators',
  author_type == 'leg' ~ 'Legal Organizations',
  author_type == 'rel' ~ 'Religious Groups',
)) %>% select(-author_type)

author_table <- author_types %>% pivot_wider(names_from = position, values_from = ct)
author_table[1,3] <- 0
author_table[3,2] <- 0

total <- c("Total", sum(author_table$`Reproductive Rights`), sum(author_table$`Antiabortion`))
author_table <- rbind(author_table, total)

stargazer(author_table, summary=FALSE, rownames=FALSE, title = "Table 1.  Total Number of Amicus Briefs by Amicus Type in the Supreme Court Abortion Cases", notes = "a. Legal cases can have more than one amicus type filed in a case (e.g., differing groups of feminist organizations can file more than one brief in a case).  Also, the same organizations file briefs in multiple cases.", header=FALSE, type = 'html', notes.align = 'l')
```




