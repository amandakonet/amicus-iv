---
title: "Paper Visualizations"
author: "Amanda Konet"
date: "`r date()`"
output:
  html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F, error = F)
library(tidyverse)
library(ggplot2)
library(boxr)
library(stargazer)
box_auth()

df <- box_read("949901868853", read_fun = readr::read_csv)
amicus <- box_read("947307207905", read_fun = readr::read_csv)
```


# Cases per Year


```{r}
num_cases <- df %>%  distinct(case, decision_date=ddate2) %>% 
  group_by(decision_date) %>% 
  summarize(n = n())

num_cases %>% 
  ggplot(., aes(x = decision_date, y = n)) +
  geom_line() + 
  labs(
    x = "Decision Year",
    y = "Count of Amici",
    title = "Number of Amici per Case"
  ) +
  theme_minimal()
```


# Number of Amici by Case

Data

```{r}
num_amici <- df %>% 
  distinct(year = lubridate::year(ddate2), cfemam, coppam) %>% 
  group_by(year) %>% 
  summarize(cfemam = mean(cfemam), coppam = mean(coppam))
```

Plot

```{r}
amici_ct_plt <- num_amici %>% 
  ggplot(., aes(x = year)) +
  geom_line(aes(y = cfemam, linetype = "Feminist")) + 
  geom_line(aes(y = coppam, linetype = "Opponent")) + 
  scale_linetype_manual("Party", values=c("Feminist" = 1,"Opponent" = 2)) + 
  coord_cartesian(ylim = c(0, 50)) +
  labs(
    x = "Decision Year",
    y = "Average Number of Amici",
    title = "Annual Average Number of Amici for Abortion Cases"
  ) + 
  theme_minimal() +
  theme(
    title = element_text(size = 10)
  )

ggsave("graphics/avg_amici_time.png",amici_ct_plt, height = 5, width = 8)
amici_ct_plt
```
Check spike
```{r}
df %>% filter(lubridate::year(ddate2) == 1989) %>% distinct(case, ddate2, cfemam, coppam)
```

# Table 1

```{r, results='asis'}
#transform dataframe
author_types <- amicus %>% select(chcauf, lifauo, medauf, medauo, legauf, legauo, relauf, relauo) %>%
  mutate(across(where(is.character), as.numeric)) %>%
  summarise(across(where(is.numeric), ~ sum(.x, na.rm = TRUE))) %>%
  pivot_longer(.,cols = c(chcauf, lifauo, medauf, medauo, legauf, legauo, relauf, relauo), names_to = "var", values_to = "ct") %>%
  arrange(var)

#clean up names
author_types <- author_types %>% mutate(author_type = substr(var, 1, 3), position = substr(var, 4, 6)) %>% select(-var)

author_types$position <- ifelse(author_types$position == "auf", 'Reproductive Rights', 'Antiabortion')
author_types <- author_types %>% mutate(`Amicus Author Type` = case_when(
  author_type == 'chc' ~ 'Feminist Organizations',
  author_type == 'lif' ~ 'Anti-Feminist Organizations',
  author_type == 'med' ~ 'Medical Practioners/Orgs/Researchers/Educators',
  author_type == 'leg' ~ 'Legal Organizations',
  author_type == 'rel' ~ 'Religious Groups',
)) %>% select(-author_type)

#clean values
author_table <- author_types %>% pivot_wider(names_from = position, values_from = ct)
author_table[1,3] <- 0
author_table[3,2] <- 0

#add totals
total <- c("Total", sum(author_table$`Reproductive Rights`), sum(author_table$`Antiabortion`))
author_table <- rbind(author_table, total)

#create table
stargazer(author_table, summary=FALSE, rownames=FALSE, title = "Table 1.  Total Number of Amicus Briefs by Amicus Type in the Supreme Court Abortion Cases", notes = "a. Legal cases can have more than one amicus type filed in a case (e.g., differing groups of feminist organizations can file more than one brief in a case).  Also, the same organizations file briefs in multiple cases.", header=FALSE, type = 'html', notes.align = 'l', out = "graphics/table1.htm")
```

# Table 2

```{r, results='asis'}
#read in models
forg_privacy <- readRDS("../modeling/amicus_type/models/forg_privacy.rds")
forg_privacy_interactions <- readRDS("../modeling/justicemq-interactions/models/forg_privacy_interactions.rds")
forg_undue <- readRDS("../modeling/amicus_type/models/forg_undue.rds")
forg_undue_interactions <- readRDS("../modeling/justicemq-interactions/models/forg_undue_interactions.rds")
lif_undue <- readRDS("../modeling/amicus_type/models/lif_undue.rds")
lif_undue_interactions <- readRDS("../modeling/justicemq-interactions/models/lif_undue_interactions.rds")
relauo_undue <- readRDS("../modeling/amicus_type/models/relauo_undue.rds")
relauo_undue_interactions <- readRDS("../modeling/justicemq-interactions/models/relauo_undue_interactions.rds")

stargazer(forg_privacy, forg_privacy_interactions,
          forg_undue, forg_undue_interactions,
          lif_undue, lif_undue_interactions,
          relauo_undue, relauo_undue_interactions,
          type='html',align=TRUE,
          model.numbers = F, ci=T,
          dep.var.labels="Justice Vote (1 = Fem)",
          column.labels = c("Model 1", "Model 2", 
                            "Model 3", "Model 4", "Model 5", "Model 6", 
                            "Model 7", "Model 8"),
          order=c("forgauf_privacy", "justicemq:forgauf_privacy",
                  "forgauf_undue_burden", "justicemq:forgauf_undue_burden",
                  "lifauo_undue_burden", "justicemq:lifauo_undue_burden",
                  "relauo_undue_burden", "justicemq:relauo_undue_burden",
                  "justicemq","justicefem1","pfemam","poppam","sgfem3","lcdisdirfem1"),
          covariate.labels = c("feminist org privacy","feminist org privacy X justice ideology",
                               "feminist org undue burden", "feminist org undue burden x justice ideology",
                               "prolife org undue burden", "prolife org undue burden x justice ideology",
                               "religious (AA) undue burden", "religious (AA) undue burden X justice ideology",
                               "justice ideology", "justice gender", "proportion RR", "proportion AA",
                               "SG amicus brief", "lower court decision"),
          out="graphics/table2.htm")
```

# Table 3

```{r, results='asis'}
#read in models
forg_womenhealth <- readRDS("../modeling/amicus_type/models/forg_womenhealth.rds")
forg_womenhealth_interactions <- readRDS("../modeling/justicemq-interactions/models/forg_womenshealth_interactions.rds")
medauf_womenhealth <- readRDS("../modeling/amicus_type/models/medauf_womenhealth.rds")
medauf_womenhealth_interactions <- readRDS("../modeling/justicemq-interactions/models/medauf_womenshealth_interactions.rds")
forg_womenfuture <- readRDS("../modeling/amicus_type/models/forg_womenfuture.rds")
relauo_abortionregret <- readRDS("../modeling/amicus_type/models/relauo_abortionregret.rds")
forg_evidence <- readRDS("../modeling/amicus_type/models/forg_evidence.rds")
forg_evidence_interactions <- readRDS("../modeling/justicemq-interactions/models/forg_evidence_interactions.rds")
medauo_evidence <- readRDS("../modeling/amicus_type/models/medauo_evidence.rds")
medauo_evidence_interactions <- readRDS("../modeling/justicemq-interactions/models/medauo_evidence_interactions.rds")

stargazer(forg_womenhealth, forg_womenhealth_interactions, 
          medauf_womenhealth, medauf_womenhealth_interactions,
          #forg_womenfuture,
          relauo_abortionregret,
          forg_evidence, forg_evidence_interactions,
          medauo_evidence, medauo_evidence_interactions
          ,title="Results", type='html',align=TRUE,
          model.numbers = F, ci=T,
          dep.var.labels="Justice Vote (1 = Fem)",
          column.labels = c("Model 1", "Model 2", 
                            "Model 3", "Model 4", "Model 5", "Model 6", 
                            "Model 7", "Model 8", "Model 9", "Model 10"),
          order=c("forgauf_womens_health", "justicemq:forgauf_womens_health",
                  "medauf_womens_health", "justicemq:medauf_womens_health",
                  #"forgauf_womens_future_life",
                  "relauo_abortion_regret",
                  "forgauf_evidence", "justicemq:forgauf_evidence",
                  "medauo_evidence", "justicemq:medauo_evidence",
                  "justicemq","justicefem1","pfemam","poppam","sgfem3","lcdisdirfem1"),
          covariate.labels = c("feminist org women's health", "feminist org women's health X justice ideology",
                               "medical (RR) women's health", "medical (RR) women's health x justice ideology",
                               #"feminist org women's futures",
                               "religious (AA) abortion regret", 
                               "feminist org expert evidence", "feminist org expert evidence X justice ideology",
                               "medical (RR) expert evidence", "medical (RR) expert evidence X justice ideology",
                               "justice ideology", "justice gender", "proportion RR", "proportion AA",
                               "SG amicus brief", "lower court decision"),
          out="graphics/table3.htm")
```

# Table 4

```{r, results='asis'}
#read in models
forg_fetus <- readRDS("../modeling/amicus_type/models/forg_fetus.rds")
forg_morality <- readRDS("../modeling/amicus_type/models/forg_morality.rds")
relauo_fetus <- readRDS("../modeling/amicus_type/models/relauo_fetus.rds")
relauo_fetus_interactions <- readRDS("../modeling/justicemq-interactions/models/relauo_fetus_interactions.rds")
medauo_morality <- readRDS("../modeling/amicus_type/models/medauo_morality.rds")

stargazer(forg_fetus, forg_morality, relauo_fetus, relauo_fetus_interactions, medauo_morality,
          title="Results", type='html',align=TRUE,
          column.labels = c("Model 1", "Model 2", "Model 3", "Model 4", "Model 5"),
          model.numbers = F, ci=T,
          dep.var.labels="Justice Vote (1 = Fem)",
          order=c("forgauf_fetus",
                  "forgauf_morality_religion",
                  "relauo_fetus", "justicemq:relauo_fetus",
                  "medauo_morality_religion",
                  "justicemq","justicefem1","pfemam","poppam","sgfem3","lcdisdirfem1"),
          covariate.labels = c("feminist org fetus",
                               "feminist org morality and religious",
                               "religious (AA) fetus", "religious (AA) fetus X justice ideology",
                               "medical (RR) morality",
                               "justice ideology", "justice gender", "proportion RR", "proportion AA",
                               "SG amicus brief", "lower court decision"),
          out="graphics/table4.htm")
```


